services:
    surfnet_stepup.repository.identity:
        class: Surfnet\Stepup\Identity\EventSourcing\IdentityRepository
        arguments:
            - @surfnet_stepup.event_store.in_memory
            - @surfnet_stepup_middleware_command_handling.event_bus.buffered

    surfnet_stepup.event_store.in_memory:
        public: false
        class: Broadway\EventStore\InMemoryEventStore

    surfnet_stepup_middleware_command_handling.event_bus.buffered:
        public: false
        class: Surfnet\StepupMiddleware\CommandHandlingBundle\EventHandling\BufferedEventBus

    surfnet_stepup_middleware_command_handling.listener.flush_event_buffer:
        class: Surfnet\StepupMiddleware\CommandHandlingBundle\EventListener\FlushEventBufferEventListener
        arguments: [ @surfnet_stepup_middleware_command_handling.event_bus.buffered ]
        tags: [{ name: kernel.event_subscriber }]
